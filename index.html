<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edumaps Generator Pro</title>
    <!-- Frameworks & Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #f8fafc; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- Icons (Lucide React equivalent via SVG) ---
        const Icons = {
            Layout: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>,
            Download: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Upload: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Plus: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Trash: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Json: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
            Settings: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Sparkles: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>,
            Book: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        };

        function App() {
            // State
            const [activeTab, setActiveTab] = useState('editor'); 
            const [mapSettings, setMapSettings] = useState({
                title: "Neue Edumap",
                tags: "",
                bg: "i10"
            });
            const [columns, setColumns] = useState([
                {
                    id: "col_start",
                    title: "Start",
                    color: "#4267F5",
                    boxes: [
                        {
                            id: "box_welcome",
                            title: "Willkommen",
                            content: "Erstelle manuell Spalten oder nutze die KI-Generatoren.",
                            color: "#ffffff",
                            subject: "Info"
                        }
                    ]
                }
            ]);

            // Local Storage Persistence
            useEffect(() => {
                const saved = localStorage.getItem("edumaps_data");
                if (saved) {
                    try { setColumns(JSON.parse(saved)); } catch (e) { console.error("Error loading saved data"); }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem("edumaps_data", JSON.stringify(columns));
            }, [columns]);

            // AI State
            const [apiKey, setApiKey] = useState("");
            const [prompt, setPrompt] = useState("");
            const [isGenerating, setIsGenerating] = useState(false);
            const [errorMsg, setErrorMsg] = useState("");

            // Lesson AI State
            const [lessonSettings, setLessonSettings] = useState({
                subject: "",
                grade: "",
                topic: "",
                target: "",
                mode: "student", 
                customPrompt: "" 
            });

            const fileInputRef = useRef(null);

            // --- Helpers ---
            const generateJSON = () => {
                const data = {
                    mapdata: {
                        title: mapSettings.title,
                        tags: mapSettings.tags,
                        mapbg: mapSettings.bg,
                        flags: "3",
                        language: "de",
                        mapformat: "0" 
                    },
                    paths: columns.map(col => ({
                        title: col.title,
                        color: col.color,
                        flags: "2",
                        boxes: col.boxes.map(box => ({
                            title: box.title,
                            content: box.content,
                            subject: box.subject,
                            color: box.color === "#ffffff" ? null : box.color,
                            flags: "4",
                            booklimit: "0"
                        }))
                    }))
                };
                return JSON.stringify(data, null, 2);
            };

            const handleDownload = () => {
                const json = generateJSON();
                const blob = new Blob([json], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `${mapSettings.title.replace(/[^a-z0-9]/gi, '_')}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleImport = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = JSON.parse(e.target.result);
                        if (!json.mapdata || !json.paths) throw new Error("Ung√ºltiges Edumaps Format");
                        setMapSettings({
                            title: json.mapdata.title || "Importierte Map",
                            tags: json.mapdata.tags || "",
                            bg: json.mapdata.mapbg || "i10"
                        });
                        const importedCols = json.paths.map((p, i) => ({
                            id: `col_imp_${i}_${Date.now()}`,
                            title: p.title || "Ohne Titel",
                            color: p.color || "#4267F5",
                            boxes: (p.boxes || []).map((b, j) => ({
                                id: `box_imp_${i}_${j}_${Date.now()}`,
                                title: b.title || "Box",
                                content: b.content || "",
                                subject: b.subject || "",
                                color: b.color || "#ffffff"
                            }))
                        }));
                        setColumns(importedCols);
                        setActiveTab('editor');
                        alert("Map erfolgreich importiert!");
                    } catch (err) {
                        alert("Fehler beim Import: " + err.message);
                    }
                };
                reader.readAsText(file);
            };

            // --- AI Logic ---
            const processAIResponse = (text, append = false) => {
                const cleanText = text.replace(/```json/g, "").replace(/```/g, "").trim();
                const parsed = JSON.parse(cleanText);
                if (!parsed.columns) throw new Error("Keine Spalten im AI-Antwortformat gefunden.");

                let tocMarkdown = "### Inhaltsverzeichnis\n\n";
                const newColumns = parsed.columns.map((col, cIdx) => {
                    const uniqueColId = Date.now() + cIdx;
                    tocMarkdown += `**${col.title}**\n`;
                    const newBoxes = col.boxes.map((box, bIdx) => {
                        const anchorName = `a_${uniqueColId}_${bIdx}`;
                        tocMarkdown += `- {${box.title}}{!#${anchorName}}\n`;
                        const contentWithAnchor = `${box.content}\n\n!#${anchorName}`;
                        return {
                            id: `box_${uniqueColId}_${bIdx}`,
                            title: box.title,
                            content: contentWithAnchor,
                            subject: box.subject || "",
                            color: box.color || "#ffffff"
                        };
                    });
                    tocMarkdown += "\n";
                    return {
                        id: `col_${uniqueColId}`,
                        title: col.title,
                        color: col.color || "#4267F5",
                        boxes: newBoxes
                    };
                });

                const tocBox = {
                    id: `box_toc_${Date.now()}`,
                    title: "Navigation & √úbersicht",
                    content: tocMarkdown,
                    color: "#fff9c4",
                    subject: "Index"
                };

                if (append) {
                    setColumns(prev => [...prev, ...newColumns]);
                } else {
                    if (newColumns.length > 0) newColumns[0].boxes.unshift(tocBox);
                    setColumns(newColumns);
                }
            };

            const generateGeneralAI = async () => {
                if (!apiKey) return setErrorMsg("Bitte API Key eingeben.");
                if (!prompt) return setErrorMsg("Bitte Inhalt eingeben.");
                setIsGenerating(true);
                setErrorMsg("");
                try {
                    const systemInstruction = `Du bist ein Experte f√ºr Edumaps. Erstelle aus dem Text eine JSON-Struktur f√ºr eine Pinnwand. Struktur: { "columns": [ { "title": "...", "color": "#hex", "boxes": [ { "title": "...", "content": "Markdown...", "subject": "..." } ] } ] }. WICHTIG: Teile den Inhalt in logische Spalten. Nutze Markdown im 'content'. Antworte NUR mit dem JSON.`;
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                        method: "POST", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ contents: [{ parts: [{ text: systemInstruction + "\n\nINHALT:\n" + prompt }] }] })
                    });
                    const result = await response.json();
                    if (result.error) throw new Error(result.error.message);
                    processAIResponse(result.candidates?.[0]?.content?.parts?.[0]?.text || "", false);
                    setActiveTab("editor");
                } catch (e) { setErrorMsg("Fehler: " + e.message); } finally { setIsGenerating(false); }
            };

            const generateLessonAI = async () => {
                if (!apiKey) return setErrorMsg("Bitte API Key eingeben.");
                if (!lessonSettings.topic || !lessonSettings.subject) return setErrorMsg("Bitte Fach und Thema eingeben.");
                setIsGenerating(true);
                setErrorMsg("");
                try {
                    const modeDesc = lessonSettings.mode === 'student' ? "Arbeitsplattform f√ºr Sch√ºler (direkte Ansprache)." : "√úbersicht f√ºr Lehrkr√§fte (Didaktik, Methodik).";
                    const systemInstruction = `
                        Du bist ein Experte f√ºr Unterrichtsplanung basierend auf dem HESSISCHEN LEHRPLAN.
                        Parameter: Fach: ${lessonSettings.subject}, Jahrgang: ${lessonSettings.grade}, Thema: ${lessonSettings.topic}, Zielgruppe: ${lessonSettings.target}, Modus: ${modeDesc}, Extra: ${lessonSettings.customPrompt || "Keine"}.
                        Aufgabe: Erstelle eine Edumap JSON-Struktur: { "columns": [ ... ] }.
                        Anforderungen:
                        1. Kompetenzorientiert.
                        2. Logische Struktur (Einstieg, Erarbeitung, Sicherung).
                        3. Farben nutzen.
                        4. DIFFERENZIERUNG: Nutze Symbole im 'subject': üü¢ (Basis), üîµ (Mittel), üü£ (Schwer).
                        5. LEGENDE: Generiere am Ende IMMER eine Box "‚ÑπÔ∏è Legende & Hilfe" mit Spoiler-Syntax "?? {Legende anzeigen}{üü¢=Basis, üîµ=Mittel, üü£=Schwer}".
                        6. Antworte NUR mit JSON.
                    `;
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                        method: "POST", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ contents: [{ parts: [{ text: systemInstruction }] }] })
                    });
                    const result = await response.json();
                    if (result.error) throw new Error(result.error.message);
                    const shouldAppend = columns.length > 1 || (columns.length === 1 && columns[0].title !== "Start");
                    processAIResponse(result.candidates?.[0]?.content?.parts?.[0]?.text || "", shouldAppend);
                    setActiveTab("editor");
                } catch (e) { setErrorMsg("Fehler: " + e.message); } finally { setIsGenerating(false); }
            };

            return (
                <div className="flex flex-col w-full h-screen bg-slate-50 text-slate-800 font-sans overflow-hidden">
                    <header className="bg-white border-b p-4 flex flex-wrap gap-4 justify-between items-center shrink-0 shadow-sm z-20">
                        <div className="flex items-center gap-2">
                            <div className="bg-gradient-to-br from-blue-600 to-indigo-700 text-white p-2 rounded shadow"><Icons.Layout /></div>
                            <div><h1 className="font-bold text-lg leading-tight text-slate-800">Edumaps Generator <span className="text-xs bg-indigo-100 text-indigo-700 px-1.5 py-0.5 rounded ml-1">Pro</span></h1><p className="text-xs text-slate-500">Editor & AI Tools</p></div>
                        </div>
                        <div className="flex gap-2 bg-slate-100 p-1 rounded-lg overflow-x-auto">
                            <button onClick={() => setActiveTab('editor')} className={`whitespace-nowrap px-3 py-1.5 text-sm rounded-md font-medium transition ${activeTab === 'editor' ? 'bg-white shadow text-blue-600' : 'text-slate-600 hover:bg-slate-200'}`}>Editor</button>
                            <button onClick={() => setActiveTab('ai')} className={`whitespace-nowrap px-3 py-1.5 text-sm rounded-md font-medium transition flex items-center gap-1 ${activeTab === 'ai' ? 'bg-white shadow text-purple-600' : 'text-slate-600 hover:bg-slate-200'}`}><Icons.Sparkles /> Text-zu-Map</button>
                            <button onClick={() => setActiveTab('lesson_ai')} className={`whitespace-nowrap px-3 py-1.5 text-sm rounded-md font-medium transition flex items-center gap-1 ${activeTab === 'lesson_ai' ? 'bg-white shadow text-indigo-600' : 'text-slate-600 hover:bg-slate-200'}`}><Icons.Book /> Unterrichts-AI</button>
                            <button onClick={() => setActiveTab('preview')} className={`whitespace-nowrap px-3 py-1.5 text-sm rounded-md font-medium transition flex items-center gap-1 ${activeTab === 'preview' ? 'bg-white shadow text-slate-900' : 'text-slate-600 hover:bg-slate-200'}`}><Icons.Json /> JSON</button>
                        </div>
                        <div className="flex items-center gap-2">
                            <input type="file" accept=".json" ref={fileInputRef} onChange={handleImport} className="hidden" />
                            <button onClick={() => fileInputRef.current.click()} className="text-slate-600 hover:bg-slate-100 px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition border border-transparent hover:border-slate-200"><Icons.Upload /> Import</button>
                            <button onClick={handleDownload} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition shadow hover:shadow-md"><Icons.Download /> Export</button>
                        </div>
                    </header>
                    <div className="flex-1 flex overflow-hidden relative">
                        <div className="w-64 bg-white border-r p-4 overflow-y-auto shrink-0 hidden md:block z-10">
                            <h3 className="text-xs font-bold uppercase text-slate-400 mb-4 flex items-center gap-2"><Icons.Settings /> Map Daten</h3>
                            <div className="space-y-4">
                                <div><label className="text-xs font-bold text-slate-700 block mb-1">Titel</label><input value={mapSettings.title} onChange={e => setMapSettings({...mapSettings, title: e.target.value})} className="w-full text-sm border rounded px-2 py-1 focus:ring-2 focus:ring-blue-100 outline-none" /></div>
                                <div><label className="text-xs font-bold text-slate-700 block mb-1">Tags</label><input value={mapSettings.tags} onChange={e => setMapSettings({...mapSettings, tags: e.target.value})} className="w-full text-sm border rounded px-2 py-1 focus:ring-2 focus:ring-blue-100 outline-none" placeholder="mathe, geschichte" /></div>
                                <div><label className="text-xs font-bold text-slate-700 block mb-1">Hintergrund</label><select value={mapSettings.bg} onChange={e => setMapSettings({...mapSettings, bg: e.target.value})} className="w-full text-sm border rounded px-2 py-1 bg-white focus:ring-2 focus:ring-blue-100 outline-none"><option value="i10">i10 (Karo)</option><option value="i1">i1 (Wei√ü)</option><option value="i2">i2 (Kork)</option><option value="i4">i4 (Holz)</option><option value="i5">i5 (Dunkel)</option></select></div>
                            </div>
                        </div>
                        <div className="flex-1 bg-slate-100 overflow-hidden relative flex flex-col">
                            {activeTab === 'editor' && (
                                <div className="flex-1 overflow-x-auto overflow-y-hidden p-4 md:p-8 fade-in">
                                    <div className="flex h-full gap-6 pb-4">
                                        {columns.map((col, cIdx) => (
                                            <div key={col.id} className="w-72 md:w-80 flex flex-col shrink-0 h-full max-h-full transition-all">
                                                <div className="p-3 rounded-t-lg flex justify-between items-center shadow-sm relative z-10" style={{ backgroundColor: col.color }}>
                                                    <input value={col.title} onChange={e => { const newCols = [...columns]; newCols[cIdx].title = e.target.value; setColumns(newCols); }} className="bg-transparent text-white font-bold w-full outline-none placeholder-white/70" placeholder="Spaltentitel" />
                                                    <div className="flex gap-1 bg-black/10 rounded p-1 backdrop-blur-sm">
                                                        <input type="color" value={col.color} onChange={e => { const newCols = [...columns]; newCols[cIdx].color = e.target.value; setColumns(newCols); }} className="w-5 h-5 p-0 border-0 rounded cursor-pointer bg-transparent" />
                                                        <button onClick={() => { if(confirm("Spalte l√∂schen?")) setColumns(columns.filter((_, i) => i !== cIdx)); }} className="text-white hover:text-red-300 rounded"><Icons.Trash /></button>
                                                    </div>
                                                </div>
                                                <div className="bg-slate-200/80 p-2 flex-1 overflow-y-auto space-y-3 rounded-b-lg border border-t-0 border-slate-300 shadow-inner">
                                                    {col.boxes.map((box, bIdx) => (
                                                        <div key={box.id} className="bg-white rounded shadow-sm border border-slate-200 group relative hover:shadow-md transition">
                                                            <div className="h-1.5 w-full rounded-t" style={{ backgroundColor: box.color !== "#ffffff" ? box.color : "transparent" }} />
                                                            <div className="p-3">
                                                                <div className="flex justify-between mb-2">
                                                                    <input value={box.title} onChange={e => { const newCols = [...columns]; newCols[cIdx].boxes[bIdx].title = e.target.value; setColumns(newCols); }} className="font-bold text-slate-800 w-full outline-none text-sm bg-transparent" placeholder="Boxtitel" />
                                                                    <button onClick={() => { const newCols = [...columns]; newCols[cIdx].boxes = newCols[cIdx].boxes.filter((_, i) => i !== bIdx); setColumns(newCols); }} className="opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 transition"><Icons.Trash /></button>
                                                                </div>
                                                                <input value={box.subject} onChange={e => { const newCols = [...columns]; newCols[cIdx].boxes[bIdx].subject = e.target.value; setColumns(newCols); }} className="text-xs bg-slate-50 w-full mb-2 px-1 rounded border-none text-slate-500" placeholder="Label..." />
                                                                <textarea value={box.content} onChange={e => { const newCols = [...columns]; newCols[cIdx].boxes[bIdx].content = e.target.value; setColumns(newCols); }} className="w-full text-xs font-mono bg-slate-50 border border-slate-200 rounded p-2 min-h-[80px] outline-none focus:ring-1 focus:ring-blue-300 resize-y text-slate-600" placeholder="Inhalt..." />
                                                                <div className="mt-2 flex justify-end opacity-0 group-hover:opacity-100 transition"><input type="color" value={box.color} onChange={e => { const newCols = [...columns]; newCols[cIdx].boxes[bIdx].color = e.target.value; setColumns(newCols); }} className="w-4 h-4 rounded-full overflow-hidden p-0 border border-slate-300 cursor-pointer" /></div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    <button onClick={() => { const newCols = [...columns]; newCols[cIdx].boxes.push({ id: Date.now(), title: "Neue Box", content: "", color: "#ffffff", subject: "" }); setColumns(newCols); }} className="w-full py-2 text-xs font-bold text-slate-500 border-2 border-dashed border-slate-300 rounded hover:bg-slate-100 hover:text-slate-700 transition flex items-center justify-center gap-1"><Icons.Plus /> Box</button>
                                                </div>
                                            </div>
                                        ))}
                                        <button onClick={() => setColumns([...columns, { id: Date.now(), title: "Neue Spalte", color: "#3D9970", boxes: [] }])} className="w-12 h-12 rounded-full bg-white shadow-md border flex items-center justify-center text-slate-400 hover:text-blue-600 hover:scale-110 transition shrink-0 mt-4" title="Spalte hinzuf√ºgen"><Icons.Plus /></button>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'ai' && (
                                <div className="p-4 md:p-8 max-w-2xl mx-auto w-full h-full overflow-y-auto fade-in">
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-purple-100">
                                        <div className="flex items-center gap-2 mb-4 text-purple-700"><div className="bg-purple-100 p-2 rounded-lg"><Icons.Sparkles /></div><h2 className="text-xl font-bold">Text-zu-Map Generator</h2></div>
                                        <div className="space-y-4">
                                            <div><label className="block text-xs font-bold text-slate-700 mb-1">Gemini API Key</label><input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder="API Key hier einf√ºgen" className="w-full border p-2 rounded focus:ring-2 focus:ring-purple-200 outline-none" /></div>
                                            <div><label className="block text-xs font-bold text-slate-700 mb-1">Inhalt</label><textarea value={prompt} onChange={e => setPrompt(e.target.value)} placeholder="Text hier einf√ºgen..." className="w-full border p-2 rounded h-40 focus:ring-2 focus:ring-purple-200 outline-none resize-none" /></div>
                                            {errorMsg && <div className="text-red-500 text-sm bg-red-50 p-2 rounded border border-red-100">{errorMsg}</div>}
                                            <button onClick={generateGeneralAI} disabled={isGenerating} className={`w-full py-3 rounded-lg font-bold text-white transition shadow ${isGenerating ? 'bg-purple-300 cursor-not-allowed' : 'bg-purple-600 hover:bg-purple-700'}`}>{isGenerating ? "Generiere..." : "Map aus Text erstellen"}</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'lesson_ai' && (
                                <div className="p-4 md:p-8 max-w-2xl mx-auto w-full h-full overflow-y-auto fade-in">
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-indigo-100">
                                        <div className="flex items-center gap-2 mb-4 text-indigo-700"><div className="bg-indigo-100 p-2 rounded-lg"><Icons.Book /></div><h2 className="text-xl font-bold">Unterrichts-Assistent (Hessen)</h2></div>
                                        <div className="space-y-4">
                                            <div><label className="block text-xs font-bold text-slate-700 mb-1">Gemini API Key</label><input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} className="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-200 outline-none" /></div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><label className="block text-xs font-bold text-slate-700 mb-1">Fach</label><input value={lessonSettings.subject} onChange={e => setLessonSettings({...lessonSettings, subject: e.target.value})} className="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-200 outline-none" /></div>
                                                <div><label className="block text-xs font-bold text-slate-700 mb-1">Jahrgang</label><input value={lessonSettings.grade} onChange={e => setLessonSettings({...lessonSettings, grade: e.target.value})} className="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-200 outline-none" /></div>
                                            </div>
                                            <div><label className="block text-xs font-bold text-slate-700 mb-1">Thema</label><input value={lessonSettings.topic} onChange={e => setLessonSettings({...lessonSettings, topic: e.target.value})} className="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-200 outline-none" /></div>
                                            <div><label className="block text-xs font-bold text-slate-700 mb-1">Zielgruppe</label><input value={lessonSettings.target} onChange={e => setLessonSettings({...lessonSettings, target: e.target.value})} className="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-200 outline-none" /></div>
                                            <div><label className="block text-xs font-bold text-slate-700 mb-1">Zus√§tzliche Anweisungen</label><textarea value={lessonSettings.customPrompt} onChange={e => setLessonSettings({...lessonSettings, customPrompt: e.target.value})} className="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-200 outline-none h-20 resize-none" /></div>
                                            <div className="flex gap-4">
                                                <label className={`flex-1 border rounded-lg p-3 cursor-pointer ${lessonSettings.mode === 'student' ? 'bg-indigo-50 border-indigo-500' : ''}`}><input type="radio" name="mode" checked={lessonSettings.mode === 'student'} onChange={() => setLessonSettings({...lessonSettings, mode: 'student'})} className="mr-2"/> Sch√ºler</label>
                                                <label className={`flex-1 border rounded-lg p-3 cursor-pointer ${lessonSettings.mode === 'teacher' ? 'bg-indigo-50 border-indigo-500' : ''}`}><input type="radio" name="mode" checked={lessonSettings.mode === 'teacher'} onChange={() => setLessonSettings({...lessonSettings, mode: 'teacher'})} className="mr-2"/> Lehrer</label>
                                            </div>
                                            {errorMsg && <div className="text-red-500 text-sm bg-red-50 p-2 rounded border border-red-100">{errorMsg}</div>}
                                            <button onClick={generateLessonAI} disabled={isGenerating} className={`w-full py-3 rounded-lg font-bold text-white transition shadow ${isGenerating ? 'bg-indigo-300 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700'}`}>{isGenerating ? "Generiere..." : "Unterricht generieren"}</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'preview' && (
                                <div className="p-4 md:p-8 h-full overflow-hidden flex flex-col fade-in">
                                    <div className="bg-white border rounded-lg shadow-sm flex-1 flex flex-col p-4 overflow-hidden">
                                        <h2 className="font-bold text-slate-700 mb-2 flex items-center gap-2"><Icons.Json /> JSON Vorschau</h2>
                                        <textarea readOnly value={generateJSON()} className="flex-1 w-full bg-slate-50 border rounded p-4 font-mono text-xs resize-none focus:outline-none text-slate-600" />
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>